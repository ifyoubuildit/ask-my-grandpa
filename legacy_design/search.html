<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - AskMyGrandpa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lora:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        vintage: {
                            dark: '#4a4036',
                            accent: '#c05621',
                            cream: '#f3f0e6',
                            green: '#6b8c85',
                            gold: '#d4a373',
                        }
                    },
                    fontFamily: {
                        heading: ['Playfair Display', 'serif'],
                        body: ['Lora', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #fdfbf7; }
        .card-shadow { box-shadow: 4px 4px 0px rgba(74, 64, 54, 0.1); }
        .highlight-skill { font-weight: 800; color: #c05621; background-color: rgba(192, 86, 33, 0.1); padding: 0 2px; border-radius: 2px; }
    </style>
</head>
<body class="font-body antialiased flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-[#fdfbf7]/95 backdrop-blur-sm border-b border-vintage-gold/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center h-24">
                <a href="index.html" class="flex-shrink-0 flex items-center gap-3 cursor-pointer mr-12">
                    <div class="relative w-12 h-12 flex items-center justify-center bg-vintage-green rounded-full text-white shadow-md">
                        <i data-lucide="glasses" class="w-8 h-8"></i>
                    </div>
                </a>
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="index.html" class="text-vintage-dark hover:text-vintage-accent font-bold text-sm uppercase tracking-widest transition-colors">Home</a>
                    <a href="mission.html" class="text-vintage-dark hover:text-vintage-accent font-bold text-sm uppercase tracking-widest transition-colors">Our Mission</a>
                    <a href="register.html" class="text-vintage-dark hover:text-vintage-accent font-bold text-sm uppercase tracking-widest transition-colors">Grandpa Registration</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Results Header -->
    <header class="pt-12 pb-8 bg-[#f0ede6] border-b border-vintage-gold/20">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p class="text-vintage-dark/60 font-body uppercase tracking-widest text-lg font-bold mb-2">Grandpas found for:</p>
            <h1 id="search-term-display" class="text-3xl md:text-4xl font-heading font-bold text-vintage-dark">Loading...</h1>
        </div>
    </header>

    <!-- Main Results Grid -->
    <main class="py-16 px-4 sm:px-6 lg:px-8">
        <div id="results-container" class="max-w-6xl mx-auto grid md:grid-cols-2 lg:grid-cols-2 gap-8">
            <!-- Results injected here -->
        </div>
        
        <div id="loading-spinner" class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-vintage-accent"></div>
            <p class="mt-4 text-vintage-dark/60">Searching the database...</p>
        </div>

        <div id="no-results" class="hidden text-center max-w-2xl mx-auto mt-10">
            <div class="w-20 h-20 bg-vintage-cream rounded-full flex items-center justify-center mx-auto mb-6 border-2 border-vintage-gold/30">
                <i data-lucide="search-x" class="w-10 h-10 text-vintage-dark/40"></i>
            </div>
            <h3 class="text-2xl font-heading font-bold text-vintage-dark mb-4">No Grandpas found for that specific skill yet.</h3>
            <p class="text-lg text-vintage-dark/80 mb-8 font-body">Be the first to join or search for a broader term!</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#e6e2d6] pt-12 pb-8 border-t border-vintage-dark/10">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <p class="text-sm text-vintage-dark/60 mb-8">&copy; 2024 AskMyGrandpa.com. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- PLACEHOLDER KEYS FOR DEMO ---
        const firebaseConfig = {
            apiKey: "PLACEHOLDER_API_KEY",
            authDomain: "PLACEHOLDER_AUTH_DOMAIN",
            projectId: "PLACEHOLDER_PROJECT_ID",
            storageBucket: "PLACEHOLDER_STORAGE_BUCKET",
            messagingSenderId: "PLACEHOLDER_SENDER_ID",
            appId: "PLACEHOLDER_APP_ID",
            measurementId: "PLACEHOLDER_MEASUREMENT_ID"
        };

        const simulatedGrandpas = [
            { name: "Grandpa Joe", address: "Calgary, AB", skills: "Woodworking, Plumbing, Sink, Leak, Basic Wiring, Fence Repair", note: "I climbed Mount Kilimanjaro in 1982 with nothing but a ham sandwich.", hasPhoto: true, image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" },
            { name: "Grandpa Bill", address: "Edmonton, AB", skills: "Car Maintenance, Fishing, Roofing, Drywall, Painting, Patching", note: "I travelled the entire US in a VW van when I was 18.", hasPhoto: false },
            { name: "Grandpa Frank", address: "Calgary, AB", skills: "Gardening, Masonry, Furniture Restoration, Sharpening, Tools, Knives", note: "I hold a patent for a specific type of fishing lure.", hasPhoto: false },
            { name: "Grandpa Tom", address: "Vancouver, BC", skills: "Electronics Repair, Small Engines, Radio Operations, Garburator, Appliances", note: "I used to play trumpet in a jazz band in New Orleans.", hasPhoto: false }
        ];

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q') || "All Grandpas";
            
            document.getElementById('search-term-display').textContent = `"${query}"`;
            const container = document.getElementById('results-container');
            const spinner = document.getElementById('loading-spinner');
            const noResults = document.getElementById('no-results');

            let grandpas = [];

            // Robust Fetch
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                // Timeout promise to ensure fallback
                const timeout = new Promise((_, reject) => setTimeout(() => reject(new Error("Timeout")), 2500));
                const fetchPromise = getDocs(collection(db, "grandpas"));

                const querySnapshot = await Promise.race([fetchPromise, timeout]);
                
                querySnapshot.forEach((doc) => {
                    grandpas.push(doc.data());
                });
            } catch (error) {
                console.warn("DB Fallback:", error);
            }

            // Combine with Simulated data for demo purposes (or use just DB if preferred)
            // For now, we concat so you see *something* always
            grandpas = grandpas.concat(simulatedGrandpas);

            spinner.classList.add('hidden');

            // --- FILTER LOGIC ---
            let filteredGrandpas = [];
            if (query === "All Grandpas") {
                filteredGrandpas = grandpas;
            } else {
                const lowerQuery = query.toLowerCase();
                filteredGrandpas = grandpas.filter(g => 
                    (g.skills && g.skills.toLowerCase().includes(lowerQuery)) || 
                    (g.name && g.name.toLowerCase().includes(lowerQuery)) ||
                    (g.address && g.address.toLowerCase().includes(lowerQuery))
                );
            }

            if (filteredGrandpas.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                filteredGrandpas.forEach(g => {
                    const card = document.createElement('div');
                    card.className = "bg-white rounded-xl card-shadow border border-vintage-gold/20 overflow-hidden flex flex-col md:flex-row";
                    
                    let imageHtml = '';
                    if (g.hasPhoto && g.image) {
                         imageHtml = `<img src="${g.image}" alt="${g.name}" class="absolute inset-0 w-full h-full object-cover">`;
                    } else {
                         imageHtml = `<div class="w-full h-full flex items-center justify-center border-r border-vintage-gold/10"><i data-lucide="user" class="w-16 h-16 text-vintage-dark/20"></i></div>`;
                    }

                    // Highlight matches
                    let displaySkills = g.skills;
                    if (query !== "All Grandpas") {
                        const regex = new RegExp(`(${query})`, 'gi');
                        displaySkills = displaySkills.replace(regex, '<span class="highlight-skill">$1</span>');
                    }

                    // Location logic
                    const locationDisplay = g.address || g.distance || "Nearby";

                    card.innerHTML = `
                        <div class="w-full md:w-1/3 bg-vintage-cream/50 relative h-64 md:h-auto flex items-center justify-center">
                            ${imageHtml}
                        </div>
                        <div class="p-6 md:p-8 flex flex-col justify-center w-full md:w-2/3">
                            <h2 class="text-2xl font-heading font-bold text-vintage-dark mb-2">${g.name}</h2>
                            <p class="text-sm text-vintage-dark/60 mb-4 flex items-center gap-1">
                                <i data-lucide="map-pin" class="w-3 h-3"></i> ${locationDisplay}
                            </p>
                            <div class="mb-6">
                                <h4 class="text-xs font-bold uppercase tracking-widest text-vintage-accent mb-2">Skill Sets</h4>
                                <p class="text-lg text-vintage-dark font-body skills-text">${displaySkills}</p>
                            </div>
                            <div class="mt-auto border-t border-vintage-gold/20 pt-4">
                                <p class="text-sm text-vintage-dark/70 italic">"${g.note}"</p>
                            </div>
                            <button class="mt-4 w-full bg-vintage-cream border border-vintage-gold/50 text-vintage-dark font-bold py-2 rounded hover:bg-vintage-gold/20 transition-colors">Connect</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>