[build]
  command = "npm ci && npm run build"
  publish = ".next"

[build.environment]
  NEXT_TELEMETRY_DISABLED = "1"
  NODE_VERSION = "20.9.0"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Netlify Forms Configuration
[forms]
  # Explicitly enable form processing
  enabled = true
  
  # Global form settings
  [forms.settings]
    # Enable spam filtering
    spam_filter = true
    
  # Form notifications
  [[forms.notifications]]
    form = "grandpa-registration"
    to = "info@askmygrandpa.com"
    subject = "ğŸ‰ New Grandpa Registration!"
    template = """
    Great news! A new Grandpa has registered on AskMyGrandpa.com

    ğŸ“ Registration Details:
    Name: {{ name }}
    Email: {{ email }}
    Phone: {{ phone }}
    Address: {{ address }}
    Contact Preference: {{ contact-preference }}
    
    ğŸ› ï¸ Skills: {{ skills }}
    
    ğŸ“– Interesting Note: {{ note }}
    
    â° Submitted: {{ timestamp }}
    
    You can view all submissions in your Netlify dashboard.
    """
    
  [[forms.notifications]]
    form = "apprentice-registration"
    to = "info@askmygrandpa.com"
    subject = "ğŸŒŸ New Apprentice Registration!"
    template = """
    Exciting news! A new Apprentice has registered on AskMyGrandpa.com

    ğŸ“ Registration Details:
    Name: {{ name }}
    Email: {{ email }}
    Phone: {{ phone }}
    Address: {{ address }}
    Contact Preference: {{ contact-preference }}
    
    ğŸ‘´ Interested in connecting with: {{ interested-grandpa }}
    
    â° Submitted: {{ timestamp }}
    
    You can view all submissions in your Netlify dashboard.
    """
    
  [[forms.notifications]]
    form = "grandpa-request"
    to = "{{ grandpa-email }}"
    subject = "ğŸ”§ New Help Request - {{ subject }}"
    template = """
    You have a new help request on AskMyGrandpa.com!

    ğŸ‘¤ From: {{ apprentice-name }} ({{ apprentice-email }})
    ğŸ“‹ Subject: {{ subject }}
    â° Availability: {{ availability }}
    
    ğŸ’¬ Message:
    {{ message }}
    
    ğŸ“… Submitted: {{ timestamp }}
    
    To respond to this request, please log into your dashboard at askmygrandpa.com/dashboard
    
    Thank you for being part of our community!
    """

# Redirect rules for form submissions
[[redirects]]
  from = "/"
  to = "/"
  status = 200
  force = false
  conditions = {Role = ["form-submission"]}